import{a as me}from"./chunk-BWXQKV75.js";import{a as Q,b as _e,c as fe}from"./chunk-SCIEU3B4.js";import{i as K,l as D,m as ue,n as ge,o as Ce,p as Se,q as ve,r as we,t as xe,u as ye,v as Me}from"./chunk-HQ4YH6WS.js";import"./chunk-V77BDGZ6.js";import{a as de,b as ce}from"./chunk-4CTIVQV3.js";import{f as he,g as be}from"./chunk-KOFPKAN7.js";import{$ as R,C as W,H as j,N as A,Q as B,U as O,W as G,aa as H,ca as z,ea as U,fa as q,n as pe,na as J,oa as se,p as L,pa as E,t as $}from"./chunk-2W3LPREW.js";import{$a as u,Ab as S,Bb as v,Cb as w,Db as oe,Eb as T,Fb as y,Gb as ae,Ka as p,La as h,P as te,Y as M,Ya as f,Z as ie,cb as N,ea as m,fa as d,fb as r,gb as o,hb as V,lb as C,mb as g,nb as c,qb as x,qc as le,rc as P,sc as k,vb as ne,wb as s,wc as F,xb as b,yb as I,zb as re}from"./chunk-2GPZ5EYJ.js";import"./chunk-GAL4ENT6.js";var ke=()=>({"margin-top":"4rem"});function Fe(a,n){if(a&1){let e=C();r(0,"div")(1,"p-card",3)(2,"div",4)(3,"p",5),s(4),o(),r(5,"p-button",6),g("onClick",function(){let i=m(e).$implicit,l=c();return d(l.goToDetail(i.group_id))}),o()()()()}if(a&2){let e=n.$implicit;p(),N(y(6,ke)),x("header","",e.name," - ",e.grade,""),p(3),I(" Total de alumnos: ",e.alumn_count," ")}}function Le(a,n){a&1&&(r(0,"div"),s(1," No cuentas con ningun grupo, empieza "),r(2,"a",7),s(3,"creando alumnos"),o(),s(4," o "),r(5,"a",8),s(6,"asignandolos un grupo"),o()())}var X=class a{constructor(n,e){this.groupsService=n;this.router=e;this.groupsService.getGroups().subscribe({next:t=>{this.groups=t}})}groups=[];goToDetail(n){this.router.navigate([`/spreed/${n}`])}static \u0275fac=function(e){return new(e||a)(h(Q),h(L))};static \u0275cmp=M({type:a,selectors:[["app-spreed-list"]],standalone:!0,features:[T],decls:5,vars:2,consts:[["header","Grupos Para Calificar"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"header"],[1,"flex","justify-content-between","flex-wrap"],[1,"m-0"],["label","Calificar",3,"onClick"],["href","/alumns/list"],["href","/groups/list"]],template:function(e,t){e&1&&(r(0,"p-card",0)(1,"p"),s(2,"Selecciona un grupo y empieza a calificar"),o(),f(3,Fe,6,7,"div",1)(4,Le,7,0,"div",2),o()),e&2&&(p(3),u("ngForOf",t.groups),p(),u("ngIf",t.groups.length<=0))},dependencies:[D,ce,de,F,P,k,E,se]})};function Oe(a,n){a&1&&(r(0,"tr")(1,"th"),s(2,"Nombre"),o(),r(3,"th"),s(4,"Apellido"),o(),r(5,"th"),s(6,"Acciones"),o()())}function Ge(a,n){if(a&1){let e=C();r(0,"tr")(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td")(6,"button",16),g("click",function(){let i=m(e).$implicit,l=c();return d(l.removeStudent(i))}),o()()()}if(a&2){let e=n.$implicit;p(2),b(e.nombre),p(2),b(e.apellido)}}function Re(a,n){a&1&&(r(0,"tr")(1,"th"),s(2,"Criterio"),o(),r(3,"th"),s(4,"Porcentaje"),o(),r(5,"th"),s(6,"Acciones"),o()())}function He(a,n){if(a&1){let e=C();r(0,"tr")(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td")(6,"button",16),g("click",function(){let i=m(e).$implicit,l=c();return d(l.removeCriterion(i))}),o()()()}if(a&2){let e=n.$implicit;p(2),b(e.nombre),p(2),I("",e.porcentaje,"%")}}var Y=class a{students=[];criteria=[];newStudentName="";newStudentLastName="";newCriterion="";newCriterionPercentage=null;addStudent(){this.newStudentName&&this.newStudentLastName&&(this.students.push({nombre:this.newStudentName,apellido:this.newStudentLastName}),this.newStudentName="",this.newStudentLastName="")}removeStudent(n){this.students=this.students.filter(e=>e!==n)}addCriterion(){this.newCriterion&&this.newCriterionPercentage!==null&&(this.criteria.push({nombre:this.newCriterion,porcentaje:this.newCriterionPercentage}),this.newCriterion="",this.newCriterionPercentage=null)}removeCriterion(n){this.criteria=this.criteria.filter(e=>e!==n)}createGroup(){console.log("Grupo creado con los siguientes alumnos:",this.students),console.log("Criterios de evaluaci\xF3n:",this.criteria)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=M({type:a,selectors:[["app-nuevo-grupo"]],standalone:!0,features:[T],decls:25,vars:7,consts:[[1,"flex","align-items-center","justify-content-center","min-h-screen"],[1,"surface-card","p-4","shadow-2","border-round","w-full","lg:w-8"],[1,"text-900","text-2xl","font-medium","mb-4","text-center"],[1,"mb-4"],[1,"text-900","text-xl","font-medium"],[1,"flex","align-items-center","mb-2"],["pInputText","","placeholder","Nombre",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pInputText","","placeholder","Apellido",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pButton","","label","A\xF1adir Alumno","icon","pi pi-plus",3,"click"],["responsiveLayout","scroll",3,"value"],["pTemplate","header"],["pTemplate","body"],["pInputText","","placeholder","Criterio de Evaluaci\xF3n",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pInputText","","placeholder","Porcentaje","type","number","min","0","max","100",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pButton","","label","A\xF1adir Criterio","icon","pi pi-plus",3,"click"],["pButton","","label","Crear Grupo","icon","pi pi-check",3,"click","disabled"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"click"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Crear Nuevo Grupo"),o(),r(4,"div",3)(5,"h3",4),s(6,"Registrar Alumnos"),o(),r(7,"div",5)(8,"input",6),w("ngModelChange",function(l){return v(t.newStudentName,l)||(t.newStudentName=l),l}),o(),r(9,"input",7),w("ngModelChange",function(l){return v(t.newStudentLastName,l)||(t.newStudentLastName=l),l}),o(),r(10,"button",8),g("click",function(){return t.addStudent()}),o()(),r(11,"p-table",9),f(12,Oe,7,0,"ng-template",10)(13,Ge,7,2,"ng-template",11),o()(),r(14,"div",3)(15,"h3",4),s(16,"Definir Criterios de Evaluaci\xF3n"),o(),r(17,"div",5)(18,"input",12),w("ngModelChange",function(l){return v(t.newCriterion,l)||(t.newCriterion=l),l}),o(),r(19,"input",13),w("ngModelChange",function(l){return v(t.newCriterionPercentage,l)||(t.newCriterionPercentage=l),l}),o(),r(20,"button",14),g("click",function(){return t.addCriterion()}),o()(),r(21,"p-table",9),f(22,Re,7,0,"ng-template",10)(23,He,7,2,"ng-template",11),o()(),r(24,"button",15),g("click",function(){return t.createGroup()}),o()()()),e&2&&(p(8),S("ngModel",t.newStudentName),p(),S("ngModel",t.newStudentLastName),p(2),u("value",t.students),p(7),S("ngModel",t.newCriterion),p(),S("ngModel",t.newCriterionPercentage),p(2),u("value",t.criteria),p(3),u("disabled",!t.students.length||!t.criteria.length))},dependencies:[D,K,j,q,U,E,J,z,A,G,B,H,R,O]})};var ze=()=>["names","last_names"],Ue=()=>({"min-width":"50rem"}),qe=()=>({width:"50vw",height:"70vw"}),Je=a=>({"row-red":a}),Ke=()=>({height:"30rem"});function Qe(a,n){if(a&1&&(r(0,"th"),s(1),o()),a&2){let e=n.$implicit;p(),b(e)}}function Xe(a,n){if(a&1&&(r(0,"tr")(1,"th"),s(2,"Nombre"),o(),r(3,"th"),s(4,"Apellido"),o(),r(5,"th"),s(6,"Calificaci\xF3n Actual"),o(),f(7,Qe,2,1,"th",17),r(8,"th"),s(9,"Acciones"),o()()),a&2){let e=c();p(7),u("ngForOf",e.getCriteriosHeaders())}}function Ye(a,n){if(a&1){let e=C();r(0,"td")(1,"div",21)(2,"label",22),s(3,"Calificaci\xF3n:"),o(),r(4,"input",23),w("ngModelChange",function(i){let l=m(e).$implicit;return v(l.grade,i)||(l.grade=i),d(i)}),g("ngModelChange",function(){m(e);let i=c().$implicit,l=c();return d(l.validatePorcentajes(i))}),o()(),r(5,"div",21)(6,"label",22),s(7,"Porcentaje:"),o(),r(8,"input",24),w("ngModelChange",function(i){let l=m(e).$implicit;return v(l.value,i)||(l.value=i),d(i)}),g("ngModelChange",function(){m(e);let i=c().$implicit,l=c();return d(l.validatePorcentajes(i))}),o()()()}if(a&2){let e=n.$implicit,t=c().$implicit;p(2),x("for","calificacion-",t.alumn_id,"-",e.criteria_id,""),p(2),x("id","calificacion-",t.alumn_id,"-",e.criteria_id,""),S("ngModel",e.grade),p(2),x("for","porcentaje-",t.alumn_id,"-",e.criteria_id,""),p(2),x("id","porcentaje-",t.alumn_id,"-",e.criteria_id,""),S("ngModel",e.value)}}function Ze(a,n){if(a&1){let e=C();r(0,"tr",18)(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td"),V(6,"p-tag",19),o(),f(7,Ye,9,14,"td",17),r(8,"td")(9,"app-obvservations",20),w("alumnChange",function(i){let l=m(e).rowIndex,_=c();return v(_.alumns[l],i)||(_.alumns[l]=i),d(i)}),o()()()}if(a&2){let e=n.$implicit,t=n.rowIndex,i=c();u("ngClass",ae(7,Je,!i.isSumaCorrecta(e)||i.getCalificacionActual(e)>100||i.getCalificacionActual(e)<0)),p(2),b(e.names),p(2),b(e.last_names),p(2),u("value",i.getCalificacionActual(e).toString())("severity",i.getSeverity(i.getCalificacionActual(e))),p(),u("ngForOf",e.criteria),p(2),S("alumn",i.alumns[t])}}function $e(a,n){a&1&&V(0,"p-messages",25)}function et(a,n){if(a&1&&(r(0,"h2"),s(1),o()),a&2){let e=c();p(),re("",e.selectedStudent.names," ",e.selectedStudent.last_names,"")}}function tt(a,n){if(a&1){let e=C();r(0,"h3"),s(1,"Observaciones:"),o(),r(2,"p-editor",26),w("ngModelChange",function(i){m(e);let l=c();return v(l.selectedStudent.observations,i)||(l.selectedStudent.observations=i),d(i)}),o()}if(a&2){let e=c();p(2),N(y(3,Ke)),S("ngModel",e.selectedStudent.observations)}}function it(a,n){if(a&1){let e=C();r(0,"button",27),g("click",function(){m(e);let i=c();return d(i.displayDialog=!1)}),o()}}var Z=class a{constructor(n,e,t,i,l){this.route=n;this.router=e;this.groupsService=t;this.messageService=i;this.loadingService=l;this.groupsService.getGroupDetails(parseInt(this.route.snapshot.paramMap.get("id"))).subscribe({next:_=>{this.alumns=_.alumns,this.group=_.group}})}alumns=[];group=null;globalFilterValue="";percentageWarning=!1;displayDialog=!1;selectedStudent;ngOnInit(){}showDetails(n){this.selectedStudent=n,this.displayDialog=!0}onDialogHide(){this.selectedStudent=null}getCriteriosHeaders(){if(this.alumns.length>0)return(this.alumns[0].criteria||[]).map(e=>e.name)}validatePorcentajes(n){let e=n.criterios.reduce((t,i)=>t+(i.porcentaje||0),0);this.percentageWarning=e!==100}getCalificacionActual(n){return n.criteria.reduce((t,i)=>t+(i.grade||0)*(i.value||0)/100,0)}getSeverity(n){return n>=70?"success":n>=40?"warning":"danger"}getSumaCriterios(n){return n.criteria.reduce((e,t)=>e+t.value,0)}isSumaCorrecta(n){return this.getSumaCriterios(n)===100}onSubmit(){this.groupsService.updateGroupDetails(this.alumns).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Exito",detail:"Cambios guardados correctamente",life:3e3})},error:n=>{this.messageService.add({severity:"error",summary:"Error",detail:n.error.message||"Ocurri\xF3 un error desconocido",life:3e3})}})}isValid(){let n=!0;for(let e of this.alumns)e.criteria.reduce((i,l)=>i+(l.value||0),0)!==100?(n=!1,this.percentageWarning=!0):this.percentageWarning=!1,e.criteria.forEach(i=>{(i.grade<0||i.grade>100||i.value<0||i.value>100)&&(n=!1)});return n}downloadGroupGrades(){this.groupsService.downloadAlumnsGrades(this.group.group_id).subscribe({next:n=>{let e=new Blob([n],{type:"application/pdf"}),t=window.URL.createObjectURL(e);window.open(t,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(t),1e4)},error:n=>{console.error("Error al obtener el PDF:",n)}})}goBack(){this.router.navigate(["/spreed"])}static \u0275fac=function(e){return new(e||a)(h(pe),h(L),h(Q),h(W),h(me))};static \u0275cmp=M({type:a,selectors:[["app-spreed-detail"]],standalone:!0,features:[oe([W]),T],decls:21,vars:14,consts:[["dt1",""],[1,"card"],[1,"p-toolbar-group-start"],["pButton","","label","Volver","icon","pi pi-arrow-left","severity","info",3,"click"],[1,"p-toolbar-group-center","w-5"],[1,"flex","align-items-center","w-full"],[1,"pi","pi-search"],["type","text","placeholder","Buscar por Nombre o Apellido",1,"ml-2","p-inputtext","w-full",3,"input"],[1,"p-toolbar-group-end"],["pButton","","label","Descargar calificaciones","icon","pi pi-file-check","severity","help",1,"mr-2","inline-block",3,"click","disabled"],["pButton","","label","Guardar","icon","pi pi-save","severity","success",1,"inline-block",3,"click","disabled"],["responsiveLayout","scroll","responsiveLayout","stack",1,"custom-table",3,"value","globalFilterFields","tableStyle"],["pTemplate","header"],["pTemplate","body"],["severity","warn","text","Los porcentajes no suman 100%",4,"ngIf"],["header","Detalles del Alumno",3,"visibleChange","onHide","visible","modal","responsive"],["pTemplate","footer"],[4,"ngFor","ngForOf"],[3,"ngClass"],[3,"value","severity"],[3,"alumnChange","alumn"],[1,"criteria-container"],[3,"for"],["pInputText","","type","number","placeholder","Calificaci\xF3n","min","0","max","100",3,"ngModelChange","id","ngModel"],["pInputText","","type","number","placeholder","Porcentaje","min","0","max","100",3,"ngModelChange","id","ngModel"],["severity","warn","text","Los porcentajes no suman 100%"],["placeholder","'Escribe tus observaciones aqu\xED...'",3,"ngModelChange","ngModel"],["pButton","","label","Listo","icon","pi pi-check",3,"click"]],template:function(e,t){if(e&1){let i=C();V(0,"p-toast"),r(1,"div",1)(2,"p-toolbar")(3,"div",2)(4,"button",3),g("click",function(){return m(i),d(t.goBack())}),o()(),r(5,"div",4)(6,"div",5),V(7,"i",6),r(8,"input",7),g("input",function(_){m(i);let Ne=ne(13);return d(Ne.filterGlobal(_.target.value,"contains"))}),o()()(),r(9,"div",8)(10,"button",9),g("click",function(){return m(i),d(t.downloadGroupGrades())}),o(),r(11,"button",10),g("click",function(){return m(i),d(t.onSubmit())}),o()()(),r(12,"p-table",11,0),f(14,Xe,10,1,"ng-template",12)(15,Ze,10,9,"ng-template",13),o(),f(16,$e,1,0,"p-messages",14),r(17,"p-dialog",15),w("visibleChange",function(_){return m(i),v(t.displayDialog,_)||(t.displayDialog=_),d(_)}),g("onHide",function(){return m(i),d(t.onDialogHide())}),f(18,et,2,2,"ng-template",12)(19,tt,3,4,"ng-template",13)(20,it,1,0,"ng-template",16),o()()}e&2&&(p(10),u("disabled",!t.isValid()),p(),u("disabled",!t.isValid()),p(),u("value",t.alumns)("globalFilterFields",y(11,ze))("tableStyle",y(12,Ue)),p(4),u("ngIf",t.percentageWarning),p(),N(y(13,qe)),S("visible",t.displayDialog),u("modal",!0)("responsive",!0))},dependencies:[D,K,j,q,U,z,A,G,B,H,R,O,le,P,ge,ue,fe,_e,we,ve,E,J,Se,Ce,be,he,xe,Me,ye,F,k],styles:['@charset "UTF-8";.custom-table[_ngcontent-%COMP%]{width:100%}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle}.row-red[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.filter-input[_ngcontent-%COMP%]{width:100%;padding:6px;font-size:16px;margin-bottom:10px}.save-button[_ngcontent-%COMP%]{margin-top:20px;display:block;margin-left:auto;margin-right:auto}.criteria-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:4px}.criteria-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:16px;flex:1;text-align:right}.criteria-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:2;min-width:50px;max-width:80px;text-align:center;font-size:18px;padding:6px}']})};var nt=[{path:"",component:X},{path:"nuevo",component:Y},{path:":id",component:Z}],De=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=ie({type:a});static \u0275inj=te({imports:[$.forChild(nt),$]})};export{De as SpreedRoutingModule};
