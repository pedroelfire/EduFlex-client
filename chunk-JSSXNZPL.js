import{a as me}from"./chunk-BWXQKV75.js";import{a as J,b as _e,c as fe}from"./chunk-RLO5ATOY.js";import{i as q,l as D,m as ue,n as ge,o as Ce,p as Se,q as we,r as ve,t as be}from"./chunk-7EPOHAHO.js";import"./chunk-V77BDGZ6.js";import{a as ce,b as de}from"./chunk-4CTIVQV3.js";import{f as he,g as xe}from"./chunk-RIPRJRBO.js";import{$ as O,C as k,H as L,N as W,Q as j,U as A,W as B,aa as G,ca as R,ea as H,fa as z,n as pe,na as U,oa as se,p as F,pa as E,t as Y}from"./chunk-2W3LPREW.js";import{$a as u,Ab as C,Bb as S,Cb as w,Db as ne,Eb as M,Fb as T,Gb as re,Ka as p,La as h,P as $,Y as y,Ya as f,Z as ee,cb as N,ea as c,fa as d,fb as r,gb as o,hb as V,lb as _,mb as g,nb as m,qb as b,qc as oe,rc as P,sc as ae,vb as te,wb as s,wc as le,xb as x,yb as I,zb as ie}from"./chunk-2GPZ5EYJ.js";import"./chunk-GAL4ENT6.js";var Ne=()=>({"margin-top":"4rem"});function Ve(a,n){if(a&1){let e=_();r(0,"div")(1,"p-card",3)(2,"div",4)(3,"p",5),s(4),o(),r(5,"p-button",6),g("onClick",function(){let t=c(e).$implicit,l=m();return d(l.goToDetail(t.group_id))}),o()()()()}if(a&2){let e=n.$implicit;p(),N(T(6,Ne)),b("header","",e.name," - ",e.grade,""),p(3),I(" Total de alumnos: ",e.alumn_count," ")}}function Ie(a,n){a&1&&(r(0,"div"),s(1," No cuentas con ningun grupo, empieza "),r(2,"a",7),s(3,"creando alumnos"),o(),s(4," o "),r(5,"a",8),s(6,"asignandolos un grupo"),o()())}var K=class a{constructor(n,e){this.groupsService=n;this.router=e;this.groupsService.getGroups().subscribe({next:i=>{this.groups=i}})}groups=[];goToDetail(n){this.router.navigate([`/spreed/${n}`])}static \u0275fac=function(e){return new(e||a)(h(J),h(F))};static \u0275cmp=y({type:a,selectors:[["app-spreed-list"]],standalone:!0,features:[M],decls:5,vars:2,consts:[["header","Grupos Para Calificar"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"header"],[1,"flex","justify-content-between","flex-wrap"],[1,"m-0"],["label","Calificar",3,"onClick"],["href","/alumns/list"],["href","/groups/list"]],template:function(e,i){e&1&&(r(0,"p-card",0)(1,"p"),s(2,"Selecciona un grupo y empieza a calificar"),o(),f(3,Ve,6,7,"div",1)(4,Ie,7,0,"div",2),o()),e&2&&(p(3),u("ngForOf",i.groups),p(),u("ngIf",i.groups.length<=0))},dependencies:[D,de,ce,le,P,ae,E,se]})};function We(a,n){a&1&&(r(0,"tr")(1,"th"),s(2,"Nombre"),o(),r(3,"th"),s(4,"Apellido"),o(),r(5,"th"),s(6,"Acciones"),o()())}function je(a,n){if(a&1){let e=_();r(0,"tr")(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td")(6,"button",16),g("click",function(){let t=c(e).$implicit,l=m();return d(l.removeStudent(t))}),o()()()}if(a&2){let e=n.$implicit;p(2),x(e.nombre),p(2),x(e.apellido)}}function Ae(a,n){a&1&&(r(0,"tr")(1,"th"),s(2,"Criterio"),o(),r(3,"th"),s(4,"Porcentaje"),o(),r(5,"th"),s(6,"Acciones"),o()())}function Be(a,n){if(a&1){let e=_();r(0,"tr")(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td")(6,"button",16),g("click",function(){let t=c(e).$implicit,l=m();return d(l.removeCriterion(t))}),o()()()}if(a&2){let e=n.$implicit;p(2),x(e.nombre),p(2),I("",e.porcentaje,"%")}}var Q=class a{students=[];criteria=[];newStudentName="";newStudentLastName="";newCriterion="";newCriterionPercentage=null;addStudent(){this.newStudentName&&this.newStudentLastName&&(this.students.push({nombre:this.newStudentName,apellido:this.newStudentLastName}),this.newStudentName="",this.newStudentLastName="")}removeStudent(n){this.students=this.students.filter(e=>e!==n)}addCriterion(){this.newCriterion&&this.newCriterionPercentage!==null&&(this.criteria.push({nombre:this.newCriterion,porcentaje:this.newCriterionPercentage}),this.newCriterion="",this.newCriterionPercentage=null)}removeCriterion(n){this.criteria=this.criteria.filter(e=>e!==n)}createGroup(){console.log("Grupo creado con los siguientes alumnos:",this.students),console.log("Criterios de evaluaci\xF3n:",this.criteria)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-nuevo-grupo"]],standalone:!0,features:[M],decls:25,vars:7,consts:[[1,"flex","align-items-center","justify-content-center","min-h-screen"],[1,"surface-card","p-4","shadow-2","border-round","w-full","lg:w-8"],[1,"text-900","text-2xl","font-medium","mb-4","text-center"],[1,"mb-4"],[1,"text-900","text-xl","font-medium"],[1,"flex","align-items-center","mb-2"],["pInputText","","placeholder","Nombre",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pInputText","","placeholder","Apellido",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pButton","","label","A\xF1adir Alumno","icon","pi pi-plus",3,"click"],["responsiveLayout","scroll",3,"value"],["pTemplate","header"],["pTemplate","body"],["pInputText","","placeholder","Criterio de Evaluaci\xF3n",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pInputText","","placeholder","Porcentaje","type","number","min","0","max","100",1,"w-5","mr-2",3,"ngModelChange","ngModel"],["pButton","","label","A\xF1adir Criterio","icon","pi pi-plus",3,"click"],["pButton","","label","Crear Grupo","icon","pi pi-check",3,"click","disabled"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Crear Nuevo Grupo"),o(),r(4,"div",3)(5,"h3",4),s(6,"Registrar Alumnos"),o(),r(7,"div",5)(8,"input",6),w("ngModelChange",function(l){return S(i.newStudentName,l)||(i.newStudentName=l),l}),o(),r(9,"input",7),w("ngModelChange",function(l){return S(i.newStudentLastName,l)||(i.newStudentLastName=l),l}),o(),r(10,"button",8),g("click",function(){return i.addStudent()}),o()(),r(11,"p-table",9),f(12,We,7,0,"ng-template",10)(13,je,7,2,"ng-template",11),o()(),r(14,"div",3)(15,"h3",4),s(16,"Definir Criterios de Evaluaci\xF3n"),o(),r(17,"div",5)(18,"input",12),w("ngModelChange",function(l){return S(i.newCriterion,l)||(i.newCriterion=l),l}),o(),r(19,"input",13),w("ngModelChange",function(l){return S(i.newCriterionPercentage,l)||(i.newCriterionPercentage=l),l}),o(),r(20,"button",14),g("click",function(){return i.addCriterion()}),o()(),r(21,"p-table",9),f(22,Ae,7,0,"ng-template",10)(23,Be,7,2,"ng-template",11),o()(),r(24,"button",15),g("click",function(){return i.createGroup()}),o()()()),e&2&&(p(8),C("ngModel",i.newStudentName),p(),C("ngModel",i.newStudentLastName),p(2),u("value",i.students),p(7),C("ngModel",i.newCriterion),p(),C("ngModel",i.newCriterionPercentage),p(2),u("value",i.criteria),p(3),u("disabled",!i.students.length||!i.criteria.length))},dependencies:[D,q,L,z,H,E,U,R,W,B,j,G,O,A]})};var Oe=()=>["names","last_names"],Ge=()=>({width:"50vw",height:"70vw"}),Re=a=>({"row-red":a}),He=()=>({height:"30rem"});function ze(a,n){if(a&1){let e=_();r(0,"div",8)(1,"button",9),g("click",function(){c(e);let t=m();return d(t.goBack())}),o(),r(2,"div"),V(3,"i",10),r(4,"input",11),g("input",function(t){c(e),m();let l=te(2);return d(l.filterGlobal(t.target.value,"contains"))}),o()(),r(5,"button",12),g("click",function(){c(e);let t=m();return d(t.downloadGroupGrades())}),o(),r(6,"button",13),g("click",function(){c(e);let t=m();return d(t.onSubmit())}),o()()}if(a&2){let e=m();p(5),u("disabled",!e.isValid()),p(),u("disabled",!e.isValid())}}function Ue(a,n){if(a&1&&(r(0,"th"),s(1),o()),a&2){let e=n.$implicit;p(),x(e)}}function qe(a,n){if(a&1&&(r(0,"tr")(1,"th"),s(2,"Nombre"),o(),r(3,"th"),s(4,"Apellido"),o(),r(5,"th"),s(6,"Calificaci\xF3n Actual"),o(),f(7,Ue,2,1,"th",14),r(8,"th"),s(9,"Acciones"),o()()),a&2){let e=m();p(7),u("ngForOf",e.getCriteriosHeaders())}}function Je(a,n){if(a&1){let e=_();r(0,"td")(1,"div",18)(2,"label",19),s(3,"Calificaci\xF3n:"),o(),r(4,"input",20),w("ngModelChange",function(t){let l=c(e).$implicit;return S(l.grade,t)||(l.grade=t),d(t)}),g("ngModelChange",function(){c(e);let t=m().$implicit,l=m();return d(l.validatePorcentajes(t))}),o()(),r(5,"div",18)(6,"label",19),s(7,"Porcentaje:"),o(),r(8,"input",21),w("ngModelChange",function(t){let l=c(e).$implicit;return S(l.value,t)||(l.value=t),d(t)}),g("ngModelChange",function(){c(e);let t=m().$implicit,l=m();return d(l.validatePorcentajes(t))}),o()()()}if(a&2){let e=n.$implicit,i=m().$implicit;p(2),b("for","calificacion-",i.alumn_id,"-",e.criteria_id,""),p(2),b("id","calificacion-",i.alumn_id,"-",e.criteria_id,""),C("ngModel",e.grade),p(2),b("for","porcentaje-",i.alumn_id,"-",e.criteria_id,""),p(2),b("id","porcentaje-",i.alumn_id,"-",e.criteria_id,""),C("ngModel",e.value)}}function Ke(a,n){if(a&1){let e=_();r(0,"tr",15)(1,"td"),s(2),o(),r(3,"td"),s(4),o(),r(5,"td"),V(6,"p-tag",16),o(),f(7,Je,9,14,"td",14),r(8,"td")(9,"app-obvservations",17),w("alumnChange",function(t){let l=c(e).rowIndex,v=m();return S(v.alumns[l],t)||(v.alumns[l]=t),d(t)}),o()()()}if(a&2){let e=n.$implicit,i=n.rowIndex,t=m();u("ngClass",re(7,Re,!t.isSumaCorrecta(e)||t.getCalificacionActual(e)>100||t.getCalificacionActual(e)<0)),p(2),x(e.names),p(2),x(e.last_names),p(2),u("value",t.getCalificacionActual(e).toString())("severity",t.getSeverity(t.getCalificacionActual(e))),p(),u("ngForOf",e.criteria),p(2),C("alumn",t.alumns[i])}}function Qe(a,n){a&1&&V(0,"p-messages",22)}function Xe(a,n){if(a&1&&(r(0,"h2"),s(1),o()),a&2){let e=m();p(),ie("",e.selectedStudent.names," ",e.selectedStudent.last_names,"")}}function Ye(a,n){if(a&1){let e=_();r(0,"h3"),s(1,"Observaciones:"),o(),r(2,"p-editor",23),w("ngModelChange",function(t){c(e);let l=m();return S(l.selectedStudent.observations,t)||(l.selectedStudent.observations=t),d(t)}),o()}if(a&2){let e=m();p(2),N(T(3,He)),C("ngModel",e.selectedStudent.observations)}}function Ze(a,n){if(a&1){let e=_();r(0,"button",24),g("click",function(){c(e);let t=m();return d(t.displayDialog=!1)}),o()}}var X=class a{constructor(n,e,i,t,l){this.route=n;this.router=e;this.groupsService=i;this.messageService=t;this.loadingService=l;this.groupsService.getGroupDetails(parseInt(this.route.snapshot.paramMap.get("id"))).subscribe({next:v=>{this.alumns=v.alumns,this.group=v.group}})}alumns=[];group=null;globalFilterValue="";percentageWarning=!1;displayDialog=!1;selectedStudent;ngOnInit(){}showDetails(n){this.selectedStudent=n,this.displayDialog=!0}onDialogHide(){this.selectedStudent=null}getCriteriosHeaders(){if(this.alumns.length>0){let n=this.alumns[0].criteria||[];return console.log(n),n.map(e=>e.name)}}validatePorcentajes(n){let e=n.criterios.reduce((i,t)=>i+(t.porcentaje||0),0);this.percentageWarning=e!==100}getCalificacionActual(n){return n.criteria.reduce((i,t)=>i+(t.grade||0)*(t.value||0)/100,0)}getSeverity(n){return n>=70?"success":n>=40?"warning":"danger"}getSumaCriterios(n){return n.criteria.reduce((e,i)=>e+i.value,0)}isSumaCorrecta(n){return this.getSumaCriterios(n)===100}onSubmit(){this.groupsService.updateGroupDetails(this.alumns).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Exito",detail:"Cambios guardados correctamente",life:3e3})},error:n=>{this.messageService.add({severity:"error",summary:"Error",detail:n.error.message||"Ocurri\xF3 un error desconocido",life:3e3})}})}isValid(){let n=!0;for(let e of this.alumns)e.criteria.reduce((t,l)=>t+(l.value||0),0)!==100?(n=!1,this.percentageWarning=!0):this.percentageWarning=!1,e.criteria.forEach(t=>{(t.grade<0||t.grade>100||t.value<0||t.value>100)&&(n=!1)});return n}downloadGroupGrades(){this.groupsService.downloadAlumnsGrades(this.group.group_id).subscribe({next:n=>{let e=new Blob([n],{type:"application/pdf"}),i=window.URL.createObjectURL(e);window.open(i,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(i),1e4)},error:n=>{console.error("Error al obtener el PDF:",n)}})}goBack(){this.router.navigate(["/spreed"])}static \u0275fac=function(e){return new(e||a)(h(pe),h(F),h(J),h(k),h(me))};static \u0275cmp=y({type:a,selectors:[["app-spreed-detail"]],standalone:!0,features:[ne([k]),M],decls:11,vars:10,consts:[["dt1",""],["responsiveLayout","scroll",1,"custom-table",3,"value","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["severity","warn","text","Los porcentajes no suman 100%",4,"ngIf"],["header","Detalles del Alumno",3,"visibleChange","onHide","visible","modal","responsive"],["pTemplate","footer"],[1,"flex","justify-content-between","flex-wrap"],["pButton","","label","Volver","icon","pi pi-arrow-left","severity","info",3,"click"],[1,"pi","pi-search"],["type","text","pInputText","","size","50","placeholder","Buscar por Nombre o Apellido",1,"ml-2",2,"width","auto","padding","5px",3,"input"],["pButton","","label","Descargar calificaciones","icon","pi pi-save",3,"click","disabled"],["pButton","","label","Guardar cambios","icon","pi pi-save","severity","success",3,"click","disabled"],[4,"ngFor","ngForOf"],[3,"ngClass"],[3,"value","severity"],[3,"alumnChange","alumn"],[1,"criteria-container"],[3,"for"],["pInputText","","type","number","placeholder","Calificaci\xF3n","min","0","max","100",3,"ngModelChange","id","ngModel"],["pInputText","","type","number","placeholder","Porcentaje","min","0","max","100",3,"ngModelChange","id","ngModel"],["severity","warn","text","Los porcentajes no suman 100%"],["placeholder","'Escribe tus observaciones aqu\xED...'",3,"ngModelChange","ngModel"],["pButton","","label","Listo","icon","pi pi-check",3,"click"]],template:function(e,i){if(e&1){let t=_();V(0,"p-toast"),r(1,"p-table",1,0),f(3,ze,7,2,"ng-template",2)(4,qe,10,1,"ng-template",3)(5,Ke,10,9,"ng-template",4),o(),f(6,Qe,1,0,"p-messages",5),r(7,"p-dialog",6),w("visibleChange",function(v){return c(t),S(i.displayDialog,v)||(i.displayDialog=v),d(v)}),g("onHide",function(){return c(t),d(i.onDialogHide())}),f(8,Xe,2,2,"ng-template",3)(9,Ye,3,4,"ng-template",4)(10,Ze,1,0,"ng-template",7),o()}e&2&&(p(),u("value",i.alumns)("globalFilterFields",T(8,Oe)),p(5),u("ngIf",i.percentageWarning),p(),N(T(9,Ge)),C("visible",i.displayDialog),u("modal",!0)("responsive",!0))},dependencies:[D,q,L,z,H,R,W,B,j,G,O,A,oe,P,ge,ue,fe,_e,ve,we,E,U,Se,Ce,xe,he,be],styles:['@charset "UTF-8";.custom-table[_ngcontent-%COMP%]{width:100%}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle}.row-red[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.filter-input[_ngcontent-%COMP%]{width:100%;padding:6px;font-size:16px;margin-bottom:10px}.save-button[_ngcontent-%COMP%]{margin-top:20px;display:block;margin-left:auto;margin-right:auto}.criteria-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:4px}.criteria-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:16px;flex:1;text-align:right}.criteria-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:2;min-width:50px;max-width:80px;text-align:center;font-size:18px;padding:6px}']})};var $e=[{path:"",component:K},{path:"nuevo",component:Q},{path:":id",component:X}],Te=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=ee({type:a});static \u0275inj=$({imports:[Y.forChild($e),Y]})};export{Te as SpreedRoutingModule};
